<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>HTTP Proxy 工具</title>
<style>
  * {
    box-sizing : border-box;
  }

  body {
    font-family      : -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background-color : #f0f2f5;
    margin           : 0;
    padding          : 2rem;
    color            : #333;
  }

  .container {
    max-width     : 800px;
    margin        : auto;
    background    : white;
    padding       : 2rem;
    border-radius : 12px;
    box-shadow    : 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  h1 {
    font-size     : 1.8rem;
    margin-bottom : 1.5rem;
    text-align    : center;
  }

  label {
    display       : block;
    margin-top    : 1rem;
    font-weight   : 600;
    margin-bottom : 0.3rem;
  }

  input, select, textarea {
    width         : 100%;
    padding       : 0.6rem;
    border        : 1px solid #ccc;
    border-radius : 6px;
    font-family   : monospace;
    font-size     : 0.95rem;
  }

  textarea {
    resize : vertical;
  }

  button {
    display          : block;
    width            : 100%;
    margin-top       : 1.5rem;
    padding          : 0.8rem;
    font-size        : 1rem;
    color            : white;
    background-color : #007bff;
    border           : none;
    border-radius    : 6px;
    cursor           : pointer;
    transition       : background-color 0.2s;
  }

  button:hover {
    background-color : #0056b3;
  }

  h2 {
    margin-top     : 2rem;
    font-size      : 1.4rem;
    border-bottom  : 1px solid #eee;
    padding-bottom : 0.5rem;
  }

  pre {
    background    : #f8f8f8;
    padding       : 1rem;
    border-radius : 8px;
    overflow-x    : auto;
    white-space   : pre-wrap;
    word-wrap     : break-word;
  }
</style>
</head>
<body>
<div class="container">
  <h1>HTTP Proxy 工具</h1>

  <label for="method">请求方式:</label>
  <select id="method">
    <option>POST</option>
    <option>GET</option>
    <option>PUT</option>
    <option>PATCH</option>
    <option>DELETE</option>
    <option>OPTIONS</option>
    <option>HEAD</option>
  </select>

  <label for="url">目标 URL:</label>
  <input type="text" id="url" value="https://httpbin.org/post"/>

  <label for="headers">请求 Headers (对象字面量或 JSON):</label>
  <textarea id="headers" rows="4">
{
  "Content-Type": "application/json"
}
    </textarea>

  <label for="body">请求 Body:</label>
  <textarea id="body" rows="6">
{
  "name": "John",
  "age": 23
}
    </textarea>

  <button onclick="sendRequest()">发送请求</button>

  <h2>响应结果:</h2>
  <pre id="response">等待请求...</pre>
</div>

<script>
  async function sendRequest(){
    const url = document.getElementById('url').value.trim();
    const method = document.getElementById('method').value;
    const headerStr = document.getElementById('headers').value.trim() || '{}';
    const headers = eval(`(${headerStr})`);
    const body = document.getElementById('body').value.trim() || null;

    const responseBox = document.getElementById('response');
    responseBox.textContent = '请求中...';

    try {
      const res = await fetch('/api/proxy', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
          url,
          method,
          headers,
          body,
        }),
      });
      let responseData;
      if (res.headers.get('Content-Type')?.includes('application/json')){
        responseData = await res.json();
      } else {
        responseData = await res.text();
      }

      const result = {
        status:res.status,
        statusText:res.statusText,
        headers:Object.fromEntries(res.headers.entries()),
        body:responseData,
      };

      responseBox.textContent = JSON.stringify(result, null, 2);
    } catch (err){
      responseBox.textContent = '请求失败:\n'+err.message;
    }
  }
</script>
</body>
</html>
