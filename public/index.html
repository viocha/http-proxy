<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>HTTP Proxy 工具</title>
<style>
  body {
    font-family : sans-serif;
    margin      : 2rem;
  }

  textarea, input, select {
    width       : 100%;
    margin-top  : 0.5rem;
    padding     : 0.5rem;
    font-family : monospace;
  }

  button {
    margin-top : 1rem;
    padding    : 0.7rem 1.2rem;
    font-size  : 1rem;
    cursor     : pointer;
  }

  pre {
    background : #f5f5f5;
    padding    : 1rem;
    overflow   : auto;
  }
</style>
</head>
<body>
<h1>HTTP Proxy 工具</h1>

<label>请求方式:</label>
<select id="method">
  <option>POST</option>
  <option>GET</option>
  <option>PUT</option>
  <option>PATCH</option>
  <option>DELETE</option>
  <option>OPTIONS</option>
  <option>HEAD</option>
</select>

<label>目标 URL:</label>
<input type="text" id="url" value="https://httpbin.org/post"/>

<label>请求 Headers (对象字面量或JSON):</label>
<textarea id="headers" rows="4">
{
  "Content-Type": "application/json"
}
</textarea>

<label>请求 Body:</label>
<textarea id="body" rows="6">
{
  "name": "John",
  "age": 23
}
</textarea>

<button onclick="sendRequest()">发送请求</button>

<h2>响应结果:</h2>
<pre id="response">等待请求...</pre>

<script>
  async function sendRequest(){
    const url = document.getElementById('url').value.trim();
    const method = document.getElementById('method').value;
    const headerString = document.getElementById('headers').value.trim() || '{}';
    const headers = eval(`(${headerString})`);
    const data = document.getElementById('body').value.trim() || null;

    const responseBox = document.getElementById('response');
    responseBox.textContent = '请求中...';

    try {
      const res = await fetch('/api/proxy', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
          url,
          method,
          headers,
          data:data,
        }),
      });

      const json = await res.json();
      responseBox.textContent = JSON.stringify(json, null, 2);
    } catch (err){
      responseBox.textContent = '请求失败:\n'+err.message;
    }
  }
</script>
</body>
</html>
